(this.webpackJsonplauttanen=this.webpackJsonplauttanen||[]).push([[0],{121:function(e,t,n){e.exports=n(180)},126:function(e,t,n){},172:function(e,t,n){e.exports=n.p+"static/media/agency.d9438b70.txt"},173:function(e,t,n){e.exports=n.p+"static/media/calendar.7f329882.txt"},174:function(e,t,n){e.exports=n.p+"static/media/calendar_dates.9aefd69f.txt"},175:function(e,t,n){e.exports=n.p+"static/media/frequencies.16dfdd58.txt"},176:function(e,t,n){e.exports=n.p+"static/media/routes.20f1bb24.txt"},177:function(e,t,n){e.exports=n.p+"static/media/stop_times.2a09dc52.txt"},178:function(e,t,n){e.exports=n.p+"static/media/stops.013405fc.txt"},179:function(e,t,n){e.exports=n.p+"static/media/trips.a34aa8ef.txt"},180:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(19),c=n.n(i),o=(n(126),n(127),n(128),n(129),n(130),n(27)),s=n.n(o),l=n(21),u=n(14),d=n(35),m=n(82),p=n(71),f=n.n(p),v=n(24),h=n(46);function g(e,t){var n=Object(h.a)(t,"yyyyMMdd"),a=t.getUTCDay(),r=e.calendar.filter((function(e){var t=e.start_date<=n&&n<=e.end_date,r=0===a&&"1"===e.sunday||1===a&&"1"===e.monday||2===a&&"1"===e.tuesday||3===a&&"1"===e.wednesday||4===a&&"1"===e.thursday||5===a&&"1"===e.friday||6===a&&"1"===e.saturday;return t&&r})).map((function(e){return e.service_id})),i=e.calendarDates.filter((function(e){return e.date===n&&"1"===e.exception_type})).map((function(e){return e.service_id})),c=e.calendarDates.filter((function(e){return e.date===n&&"2"===e.exception_type})).map((function(e){return e.service_id}));return function(e){for(var t=new Set(e),n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return a.forEach((function(e){return e.forEach((function(e){return t.delete(e)}))})),t}(function(){for(var e=new Set,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach((function(t){return t.forEach((function(t){return e.add(t)}))})),e}(new Set(r),new Set(i)),new Set(c))}function E(e){return b.apply(this,arguments)}function b(){return(b=Object(d.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.keys(t).map(function(){var e=Object(d.a)(s.a.mark((function e(n){var a,r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t[n]);case 2:if((r=e.sent).ok){e.next=5;break}throw new Error(r.statusText);case 5:return e.next=7,r.text();case 7:return i=e.sent.replace(/[\r\n]+/g,"\n").trim(),c=f.a.parse(i,{header:!0}),(null===(a=c.errors)||void 0===a?void 0:a.length)&&console.warn(n,c.errors),e.abrupt("return",[n,c.data]);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(n);case 3:return a=e.sent,e.abrupt("return",Object.fromEntries(a));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){var n=Object(h.a)(t,"yyyyMMdd");e.calendarDates=e.calendarDates.filter((function(e){return e.date>=n})),e.calendar=e.calendar.filter((function(e){return e.end_date>=n}))}function x(e){var t=Object(v.groupBy)(e.stopTimes,(function(e){return e.trip_id})),n=function(e){var t={};for(var n in e){var a=e[n];if(2===a.length){var r=Object(u.a)(a,2),i=r[0],c=r[1],o="".concat(i.stop_id,",").concat(c.stop_id);t[o]||(t[o]=new Set),t[o].add(n)}}return t}(t);return Object(m.a)({},e,{routeMap:Object(v.keyBy)(e.routes,"route_id"),stopMap:Object(v.keyBy)(e.stops,"stop_id"),tripMap:Object(v.keyBy)(e.trips,"trip_id"),tripStopSequences:t,tripStopFromToMap:n})}var O=n(72),S=n(73),T=n(74);function j(e,t,n){return 60*e*60+60*t+n}function M(e){var t=e.split(":").map((function(e){return parseInt(e,10)})),n=Object(u.a)(t,3);return[n[0],n[1],n[2]]}var D,k=n(187),w=n(188);function _(e,t,n,a){var r,i=function(e,t,n,a){var r=e.tripStopFromToMap,i=Array.from(r["".concat(n,",").concat(a)]||[]),c=g(e,t),o=new Set;return i.forEach((function(t){return o.add(e.tripMap[t].service_id)})),i.map((function(t,n){var a=e.tripMap[t];return a&&c.has(a.service_id)?a:void 0})).filter(Boolean)}(e,t,n,a),c=j((r=t).getHours(),r.getMinutes(),r.getSeconds());return i.filter((function(t){return function(e){var t=M(e),n=Object(u.a)(t,3);return j(n[0],n[1],n[2])}(e.tripStopSequences[t.trip_id][0].departure_time)>=c}))}!function(e){e.ERROR="error",e.WAIT="wait",e.DRIVE="drive",e.FERRY="ferry"}(D||(D={}));var I=function(){function e(t,n,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Object(S.a)(this,e),this.interStopTravelMap=void 0,this.gtfsData=void 0,this.driveMultipliers=void 0,this.disembarkTimeMin=void 0,this.maxFerryOptions=5,this.gtfsData=t,this.interStopTravelMap=n,this.driveMultipliers=a,this.disembarkTimeMin=r}return Object(T.a)(e,[{key:"computeMultilegBitRecur",value:function(e,t){var n=this;if(!t.length)return[];var a=Object(O.a)(t),r=a[0],i=a.slice(1),c=Object(u.a)(r,2),o=c[0],s=c[1],l="".concat(o,",").concat(s),d=this.gtfsData.stopMap[o],m=this.gtfsData.stopMap[s];if(this.interStopTravelMap[l])return(i.length>0?this.driveMultipliers:[1]).map((function(t){var a=n.interStopTravelMap[l]*t,r=k.a(e,{minutes:a});return{id:"".concat(o,"-").concat(s,"-").concat(+e,"-").concat(+r),type:D.DRIVE,text:"".concat(d.stop_name," -> ").concat(m.stop_name),remark:1!==t?"".concat(t.toFixed(1),"x traffic adjustment"):void 0,startTime:e,endTime:r,startStopId:o,endStopId:s,next:n.computeMultilegBitRecur(r,i)}}));var p=_(this.gtfsData,e,o,s).slice(0,this.maxFerryOptions);return p.length?p.map((function(t){var a=n.gtfsData.tripStopSequences[t.trip_id],r=M(a[0].departure_time),c=Object(u.a)(r,3),l=c[0],d=c[1],m=c[2],p=M(a[1].arrival_time),f=Object(u.a)(p,3),v=f[0],h=f[1],g=f[2],E=w.a(e,{hours:l,minutes:d,seconds:m}),b=k.a(w.a(e,{hours:v,minutes:h,seconds:g}),{minutes:n.disembarkTimeMin});return{id:"".concat(t.trip_id),type:D.FERRY,text:t.trip_headsign,startTime:E,endTime:b,startStopId:o,endStopId:s,next:n.computeMultilegBitRecur(b,i)}})):[{id:"".concat(o,"-").concat(s,"-").concat(+e,"-error"),type:D.ERROR,text:"no valid route: ".concat(d.stop_name," -> ").concat(m.stop_name),startTime:e,endTime:e,startStopId:o,endStopId:s,next:[]}]}},{key:"computeMultileg",value:function(e,t){var n=this.computeMultilegBitRecur(e,function(e){for(var t=[],n=1;n<e.length;n++)t.push([e[n-1],e[n]]);return t}(t)),a={},r={};return n.forEach((function(e){return function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=r[t.id]=r[t.id]||new Set;n.forEach((function(e){return a.add(e.id)})),t.next.forEach((function(a){return e(a,[].concat(Object(l.a)(n),[t]))}))}(e)})),Object.keys(r).forEach((function(e){r[e].forEach((function(t){(a[t]=a[t]||new Set).add(e)}))})),{legs:n,legSuccessors:a,legPredecessors:r}}}]),e}(),R=n(189),C=n(3),B=n.n(C),F=n(185);function H(e){var t=e.leg,n=e.parentLeg,a=e.depth,i=e.accumulatedDuration,c=e.result,o=e.highlight,s=e.setHighlight,l=function(e){switch(e.type){case D.ERROR:return"\u26a1";case D.DRIVE:return"\ud83d\ude97";case D.FERRY:return"\ud83d\udea4";case D.WAIT:return"\u23f3"}return"???"}(t),u=n?R.a(t.startTime,n.endTime):void 0,d=R.a(t.endTime,t.startTime),m=(i||0)+d,p=0===t.next.length,f={initial:0===a,final:p};return o&&o!==t.id&&!c.legPredecessors[t.id].has(o)&&(f.faded=!0),o===t.id&&(f.highlight=!0),r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",{className:B()(f),onClick:function(){return s(o===t.id?void 0:t.id)}},r.a.createElement("td",{className:"dt st"},h.a(t.startTime,"HH:mm")),r.a.createElement("td",{className:"dt et"},h.a(t.endTime,"HH:mm")),r.a.createElement("td",{className:"dt du"},d," min"),r.a.createElement("td",{className:"dt wt"},void 0!==u&&u>0?"".concat(u," min"):null),r.a.createElement("td",{className:"tl"},l),r.a.createElement("td",{className:"tx"},r.a.createElement("div",{style:{paddingLeft:"".concat(a,"em")}},t.text,r.a.createElement("span",{className:"remark"},t.remark))),r.a.createElement("td",{className:"dt adu"},p?r.a.createElement(r.a.Fragment,null,m," min"):null)),t.next.map((function(n,i){return r.a.createElement(H,Object.assign({},e,{leg:n,parentLeg:t,key:i,depth:a+1,accumulatedDuration:m}))})))}function N(e){return r.a.createElement(F.g,{id:"t",interactive:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Start"),r.a.createElement("th",null,"End"),r.a.createElement("th",null,"Dur"),r.a.createElement("th",null,"Wait"),r.a.createElement("th",null,"Type"),r.a.createElement("th",null,"Description"),r.a.createElement("th",null,"Total Dur"))),r.a.createElement("tbody",null,e.result.legs.map((function(t,n){return r.a.createElement(H,Object.assign({},e,{leg:t,key:n,depth:0}))}))))}var A=n(78),P=(n(159),["changed","click","contextmenu","currentTimeTick","doubleClick","drop","groupDragged","itemout","itemover","mouseDown","mouseMove","mouseOver","mouseUp","rangechange","rangechanged","select","timechange","timechanged"]),q=function(e){var t=e.options,n=e.items,a=e.groups,i=e.eventHandlers,c=r.a.useRef(null),o=r.a.useRef(null),s=r.a.useRef(i);r.a.useEffect((function(){s.current=i}),[i]);var l=r.a.useCallback((function(e,t){var n=s.current;n&&e in n&&n[e](t)}),[]);return r.a.useEffect((function(){if(c.current){var e=o.current;e?(e.setOptions(t),e.setItems(n)):(e=new A.Timeline(c.current,n,t),P.forEach((function(t){return e&&e.on(t,(function(e){return l(t,e)}))})),o.current=e),e.setGroups(a)}return function(){o.current&&(o.current.destroy(),o.current=null)}}),[l,n,t,a,c]),r.a.createElement("div",{ref:c})},z={width:"100%",stack:!0,showCurrentTime:!0};function L(e){var t=e.gtfsData,n=e.result,a=e.highlight,i=e.setHighlight,c=n.legs,o=n.legPredecessors,s=r.a.useMemo((function(){var e={},n={},r={},i={};if(c.forEach((function(a){return function a(c,s){var u=c.id,d="".concat(c.startStopId,"-").concat(c.endStopId);if(!(d in n)){var m=t.stopMap[c.endStopId].stop_name;n[d]={id:d,content:"".concat(c.type," to ").concat(m)}}var p=r[u]=r[u]||{};i[u]=o[c.id],p[c.type]=!0,c.next.length||(p.final=!0),s.length||(p.initial=!0),e[u]={id:u,group:d,start:c.startTime,end:c.endTime,content:c.text},c.next.forEach((function(e){return a(e,[].concat(Object(l.a)(s),[[c,u]]))}))}(a,[])})),a)for(var s in e)s===a||i[s].has(a)||(r[s].faded=!0);for(var u in r)e[u]&&(e[u].className=B()(r[u]));return[Object(l.a)(Object.values(e)),Object(l.a)(Object.values(n))]}),[t.stopMap,c,a]),d=Object(u.a)(s,2),m=d[0],p=d[1];return r.a.createElement(q,{options:z,items:m,groups:p,eventHandlers:{select:function(e){var t=e.items;return i(t[0])}}})}var G=["1","3","4","29","6","24"],V={};[[["4","29"],30],[["6","24"],30],[["1","3"],45]].forEach((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1],r=Object(u.a)(n,2),i=r[0],c=r[1];V["".concat(i,",").concat(c)]=a,V["".concat(c,",").concat(i)]=a}));var W=n(186),Y=n(83),J={formatDate:function(e){return h.a(e,"yyyy-MM-dd")},parseDate:function(e){return new Date(e)}};function U(e){var t=e.date,n=e.onChange;return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{flex:1}},r.a.createElement(W.a,Object.assign({},J,{showActionsBar:!0,value:t,onChange:function(e,t){return t?n(e):null}}))),r.a.createElement("div",{style:{flex:1}},r.a.createElement(Y.a,{value:t,onChange:n})))}function K(e){var t=e.stopIds,n=e.setStopIds,a=e.gtfsData,i=e.driveTravelTimes,c=t.length?t[t.length-1]:null,o=function(e,t){var n=new Set;for(var a in e.tripStopSequences){var r=e.tripStopSequences[a];if(2===r.length){var i=Object(u.a)(r,2),c=i[0],o=i[1];null===t?n.add(c.stop_id):c.stop_id===t&&n.add(o.stop_id)}}return n}(a,c);c&&Object.keys(i).forEach((function(e){var t=e.split(","),n=Object(u.a)(t,2),a=n[0],r=n[1];a===c&&o.add(r)}));var s=r.a.createElement(F.f,{disabled:!o.size,onChange:function(e){var a=e.target.value;o.has(a)&&n(t.concat([a]))}},r.a.createElement("option",{value:""},"Add..."),Object(v.sortBy)(Array.from(o).map((function(e){return[e,a.stopMap[e].stop_name]})),1).map((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];return r.a.createElement("option",{key:n,value:n},a)})));return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,t.map((function(e,i){return r.a.createElement(F.q,{key:i,large:!0,onRemove:function(){return n(t.filter((function(t){return t!==e})))},style:{marginRight:".5em"}},a.stopMap[e].stop_name)}))),r.a.createElement("div",{style:{marginTop:".5em"}},s," ",r.a.createElement(F.a,{icon:"refresh",disabled:!t.length,onClick:function(){return n(Object(v.reverse)(Object(l.a)(t)))}},"Reverse")," ",r.a.createElement(F.a,{icon:"delete",disabled:!t.length,onClick:function(){return n([])}},"Clear")))}function Q(e){return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(F.b,{style:{flex:1,margin:".5em"}},r.a.createElement(F.e,null,"Departure Time"),r.a.createElement(U,{date:e.date,onChange:e.onChangeDate})),r.a.createElement(F.b,{style:{flex:3,margin:".5em"}},r.a.createElement(F.e,null,"Route"),r.a.createElement(K,{stopIds:e.stopIds,setStopIds:e.setStopIds,gtfsData:e.gtfsData,driveTravelTimes:V})),r.a.createElement(F.b,{style:{flex:1,margin:".5em"}},r.a.createElement(F.e,null,"Options"),r.a.createElement(F.d,{label:"Disembarkation time (min)"},r.a.createElement(F.n,{min:0,max:20,stepSize:1,labelStepSize:5,onChange:e.setDisembarkTimeMin,value:e.disembarkTimeMin})),r.a.createElement(F.d,{label:"Drive time multiplier"},r.a.createElement(F.n,{min:0,max:2,stepSize:.1,labelStepSize:.5,onChange:e.setDriveTimeMultiplier,value:e.driveTimeMultiplier}))))}var X=n(52),Z=n.n(X),$=n(80),ee=n.n($),te=n(81),ne=n.n(te);function ae(e){var t=e.gtfsData,n=e.result.legs,a={},i={};function c(e,n){var r="",o="";r=n.length?n[n.length-1][2]:function(e){var n="stop-".concat(e);if(!a[n]){var r=t.stopMap[e];a[n]={data:{id:n,label:r.stop_name}}}return n}(e.startStopId),o="".concat(e.endStopId,"-").concat(e.endTime);var s=t.stopMap[e.endStopId];a[o]={data:{id:o,label:"".concat(s.stop_name," at ").concat(h.a(e.endTime,"HH:mm"))}};var u="".concat(r,"-").concat(o,"-").concat(e.startTime),d=R.a(e.endTime,e.startTime),m=n.length?n[n.length-1][0]:void 0,p=m?R.a(e.startTime,m.endTime):void 0,f=(p?"".concat(p,"min wait, "):"")+"".concat(d,"min ").concat(e.type);i[u]={data:{id:u,source:r,target:o,label:f},classes:"".concat(e.type)},e.next.forEach((function(t){return c(t,[].concat(Object(l.a)(n),[[e,r,o]]))}))}return n.forEach((function(e){return c(e,[])})),r.a.createElement(ne.a,{elements:[].concat(Object(l.a)(Object.values(a)),Object(l.a)(Object.values(i))),stylesheet:[{selector:"node",style:{label:"data(label)"}},{selector:"edge",style:{label:"data(label)","curve-style":"straight"}},{selector:"edge.ferry",style:{"line-color":"navy"}}],layout:{name:"klay",nodeDimensionsIncludeLabels:!0,klay:{direction:"RIGHT",edgeRouting:"SPLINES"}},style:{width:"100%",height:"600px",border:"1px solid orange"}})}function re(){return(re=Object(d.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E({agency:n(172),calendar:n(173),calendarDates:n(174),frequencies:n(175),routes:n(176),stopTimes:n(177),stops:n(178),trips:n(179)});case 2:return a=e.sent,t&&y(a,t),e.abrupt("return",x(a));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e){return r.a.createElement(F.p,{id:e.id,renderActiveTabPanelOnly:!0},r.a.createElement(F.o,{id:"timeline",title:"Timeline",panel:r.a.createElement(L,e.viewProps)}),r.a.createElement(F.o,{id:"table",title:"Table",panel:r.a.createElement(N,e.viewProps)}),r.a.createElement(F.o,{id:"graph",title:"Graph",panel:r.a.createElement(ae,e.viewProps)}),e.renderButton?r.a.createElement(r.a.Fragment,null,r.a.createElement(F.p.Expander,null),r.a.createElement(F.a,{icon:"split-columns",active:e.buttonActive,onClick:e.onButtonClick},"Split")):null)}function ce(e){var t=e.gtfsData,n=r.a.useState(),a=Object(u.a)(n,2),i=a[0],c=a[1],o=r.a.useState((function(){return new Date})),s=Object(u.a)(o,2),d=s[0],m=s[1],p=r.a.useState((function(){return Object(l.a)(G)})),f=Object(u.a)(p,2),g=f[0],E=f[1],b=r.a.useState(3),y=Object(u.a)(b,2),x=y[0],O=y[1],S=r.a.useState(1.5),T=Object(u.a)(S,2),j=T[0],M=T[1],D=r.a.useState(!1),k=Object(u.a)(D,2),w=k[0],_=k[1],R=r.a.useMemo((function(){return new I(t,V,Object(v.uniq)([1,j]),x)}),[t,x,j]),C=r.a.useMemo((function(){return R.computeMultileg(d,g)}),[R,d,g]),B={gtfsData:t,result:C,highlight:i,setHighlight:c},H=C.legs.length?r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,h.a(d,"dd.MM.yyyy HH:mm"),r.a.createElement("br",null),g.map((function(e){return t.stopMap[e]})).map((function(e){return e.stop_name})).join(" - ")),r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{flex:1}},r.a.createElement(ie,{id:"tabs1",viewProps:B,renderButton:!0,buttonActive:w,onButtonClick:function(){return _(!w)}})),w?r.a.createElement("div",{style:{flex:1}},r.a.createElement(ie,{id:"tabs2",viewProps:B})):null)):r.a.createElement(F.l,{icon:"search",title:"No results"});return r.a.createElement("div",{className:"App"},r.a.createElement(Q,{date:d,onChangeDate:m,stopIds:g,setStopIds:E,gtfsData:t,setDisembarkTimeMin:O,disembarkTimeMin:x,setDriveTimeMultiplier:function(e){return M(parseFloat(e.toFixed(2)))},driveTimeMultiplier:j}),H)}Z.a.use(ee.a);var oe=function(){var e=r.a.useState(),t=Object(u.a)(e,2),n=t[0],a=t[1];return r.a.useEffect((function(){(function(e){return re.apply(this,arguments)})(new Date(2020,0)).then(a)}),[]),void 0===n?null:r.a.createElement(ce,{gtfsData:n})};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(oe,null)),document.getElementById("root"))}},[[121,1,2]]]);
//# sourceMappingURL=main.5c2db9ad.chunk.js.map